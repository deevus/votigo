{{define "content"}}
<div class="max-w-2xl mx-auto space-y-8">
    <!-- Header -->
    <header>
        <a href="/admin" class="text-neutral-500 text-xs hover:text-neutral-300 mb-4 inline-block">
            ‚Üê Back to Dashboard
        </a>
        <h1 class="font-arcade text-lg text-arcade-green glow-green">
            {{if .Category}}EDIT POLL{{else}}NEW POLL{{end}}
        </h1>
    </header>

    {{if .Error}}
    <div class="bg-arcade-red/10 border border-arcade-red/30 text-arcade-red px-4 py-3 rounded">
        {{.Error}}
    </div>
    {{end}}

    <!-- Poll form -->
    <div class="arcade-border bg-arcade-panel p-6 space-y-6">
        <form method="POST" class="space-y-6">
            <div class="grid gap-6 md:grid-cols-2">
                <div>
                    <label class="block text-xs text-neutral-400 mb-2 uppercase tracking-wide">
                        Poll Name
                    </label>
                    <input type="text" name="name"
                           value="{{if .Category}}{{.Category.Name}}{{end}}"
                           placeholder="Enter name..."
                           class="input-arcade">
                </div>
                <div>
                    <label class="block text-xs text-neutral-400 mb-2 uppercase tracking-wide">
                        Vote Type
                    </label>
                    <select name="vote_type" class="select-arcade">
                        <option value="single" {{if and .Category (eq .Category.VoteType "single")}}selected{{end}}>Single Choice</option>
                        <option value="approval" {{if and .Category (eq .Category.VoteType "approval")}}selected{{end}}>Approval</option>
                        <option value="ranked" {{if and .Category (eq .Category.VoteType "ranked")}}selected{{end}}>Ranked</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-neutral-400 mb-2 uppercase tracking-wide">
                        Max Rank
                    </label>
                    <input type="number" name="max_rank" min="1"
                           value="{{if and .Category .Category.MaxRank.Valid}}{{.Category.MaxRank.Int64}}{{else}}3{{end}}"
                           class="input-arcade w-24">
                </div>
                <div>
                    <label class="block text-xs text-neutral-400 mb-2 uppercase tracking-wide">
                        Show Results
                    </label>
                    <select name="show_results" class="select-arcade">
                        <option value="after_close" {{if and .Category (eq .Category.ShowResults "after_close")}}selected{{end}}>After Close</option>
                        <option value="live" {{if and .Category (eq .Category.ShowResults "live")}}selected{{end}}>Live</option>
                    </select>
                </div>
            </div>

            <button type="submit"
                    class="bg-arcade-green hover:bg-green-400 text-arcade-dark px-6 py-2 rounded font-medium transition-colors btn-arcade">
                Save Category
            </button>
        </form>
    </div>

    {{if .Category}}
    <!-- Options section -->
    <div class="arcade-border bg-arcade-panel p-6 space-y-4">
        <h2 id="options" class="text-xs text-neutral-400 uppercase tracking-wide">
            Options
        </h2>

        <!-- Add option form -->
        <form hx-post="/admin/category/{{.Category.ID}}/option"
              hx-target="#options-list"
              hx-swap="beforeend"
              hx-on::after-request="this.reset()"
              class="flex gap-2">
            <input type="text" name="option_name"
                   placeholder="New option name..."
                   class="input-arcade flex-1">
            <button type="submit"
                    class="bg-neutral-800 hover:bg-neutral-700 text-neutral-300 px-4 py-2 rounded transition-colors">
                Add
            </button>
        </form>

        <!-- Options list -->
        <div id="options-list" class="space-y-2">
            {{range .Options}}
            {{template "option-row-content" .}}
            {{end}}
        </div>

        {{if not .Options}}
        <p class="text-neutral-600 text-sm" id="no-options">No options yet.</p>
        {{end}}
    </div>
    {{end}}
</div>
{{end}}

{{define "option-row-content"}}
<div id="option-{{.ID}}"
     class="flex items-center justify-between p-3 bg-arcade-dark rounded border border-arcade-border">
    <span class="text-neutral-300">{{.Name}}</span>
    <button hx-delete="/admin/option/{{.ID}}"
            hx-target="#option-{{.ID}}"
            hx-swap="outerHTML"
            class="text-arcade-red hover:text-red-300 text-xs transition-colors">
        Delete
    </button>
</div>
{{end}}
