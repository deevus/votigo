{{define "content"}}
<div class="bg-white rounded-lg shadow p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">{{.Category.Name}}</h1>

    <div id="vote-form">
        {{template "vote-form-inner" .}}
    </div>
</div>
{{end}}

{{define "vote-form-inner"}}
{{if .Success}}
<div class="text-center py-8">
    <div class="text-green-600 text-xl font-semibold mb-4">{{.Success}}</div>
    <a href="/" class="text-blue-600 hover:underline">&larr; Back to home</a>
</div>
{{else}}
{{if .Error}}
<div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4">
    {{.Error}}
</div>
{{end}}

<form method="POST" action="/vote/{{.Category.ID}}"
      hx-post="/vote/{{.Category.ID}}"
      hx-target="#vote-form"
      hx-swap="innerHTML">

    <div class="mb-6">
        <label for="nickname" class="block text-sm font-medium text-gray-700 mb-2">Your nickname</label>
        <input type="text" name="nickname" id="nickname" value="{{.Nickname}}"
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
               placeholder="Enter your nickname">
    </div>

    {{if eq .Category.VoteType "single"}}
    <div class="mb-6">
        <p class="text-sm font-medium text-gray-700 mb-3">Select one:</p>
        <div class="space-y-2">
            {{range .Options}}
            <label class="flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                <input type="radio" name="choice" value="{{.ID}}" class="mr-3">
                <span>{{.Name}}</span>
            </label>
            {{end}}
        </div>
    </div>

    {{else if eq .Category.VoteType "approval"}}
    <div class="mb-6">
        <p class="text-sm font-medium text-gray-700 mb-3">Select all that apply:</p>
        <div class="space-y-2">
            {{range .Options}}
            <label class="flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                <input type="checkbox" name="choice" value="{{.ID}}" class="mr-3">
                <span>{{.Name}}</span>
            </label>
            {{end}}
        </div>
    </div>

    {{else if eq .Category.VoteType "ranked"}}
    <div class="mb-6">
        <p class="text-sm font-medium text-gray-700 mb-3">Rank your top {{.MaxRank}} choices:</p>
        <div class="space-y-3">
            {{range $i, $e := .Ranks}}
            {{$rank := add $i 1}}
            <div class="flex items-center gap-3">
                <span class="text-sm font-medium text-gray-600 w-20">Choice #{{$rank}}</span>
                <select name="rank{{$rank}}"
                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">-- Select --</option>
                    {{range $.Options}}
                    <option value="{{.ID}}">{{.Name}}</option>
                    {{end}}
                </select>
            </div>
            {{end}}
        </div>
    </div>
    {{end}}

    <button type="submit"
            class="w-full px-4 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">
        Submit Vote
    </button>
</form>

<p class="mt-6 text-center">
    <a href="/" class="text-blue-600 hover:underline">&larr; Back to home</a>
</p>
{{end}}
{{end}}
