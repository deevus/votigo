{{define "content"}}
<div class="space-y-8">
    <!-- Header -->
    <header>
        <a href="/results" class="text-neutral-500 text-xs hover:text-neutral-300 mb-4 inline-block">
            ‚Üê Back
        </a>
        <div class="flex items-center justify-between">
            <div>
                <h1 class="font-arcade text-lg text-arcade-amber glow-amber">
                    {{.Category.Name}}
                </h1>
                {{if not .NotVisible}}
                <p class="text-neutral-500 text-sm mt-1">{{.VoteCount}} total votes</p>
                {{end}}
            </div>
            {{if and (not .NotVisible) (eq .Category.Status "open")}}
            <span class="badge-live">Live</span>
            {{end}}
        </div>
    </header>

    {{if .NotVisible}}
    <!-- Results hidden -->
    <div class="arcade-border bg-arcade-panel/50 p-8 text-center">
        <div class="text-neutral-500">
            Results are not available yet
        </div>
        <div class="text-neutral-600 text-sm mt-2">
            Check back after voting closes
        </div>
    </div>
    {{else}}
    <!-- Results table -->
    <div id="results-table"
         class="arcade-border bg-arcade-panel overflow-hidden"
         {{if eq .Category.Status "open"}}
         hx-get="/results/{{.Category.ID}}/table"
         hx-trigger="every 5s"
         hx-swap="innerHTML"
         {{end}}>
        {{template "results-table-content" .}}
    </div>

    {{if eq .Category.Status "open"}}
    <p class="text-center text-neutral-600 text-xs">
        Results update automatically every 5 seconds
    </p>
    {{end}}
    {{end}}
</div>
{{end}}

{{define "results-table-content"}}
<table class="w-full">
    <thead>
        <tr class="border-b border-arcade-border text-xs text-neutral-500 uppercase tracking-wide">
            <th class="text-left p-4 w-12">#</th>
            <th class="text-left p-4">Option</th>
            {{if eq .Category.VoteType "ranked"}}
            <th class="text-right p-4">Points</th>
            <th class="text-right p-4">1st</th>
            {{else}}
            <th class="text-right p-4">Votes</th>
            {{end}}
        </tr>
    </thead>
    <tbody>
        {{range $i, $r := .Results}}
        <tr class="border-b border-arcade-border/50 last:border-0 {{if eq $i 0}}bg-arcade-amber/5{{end}}">
            <td class="p-4">
                <span class="w-6 h-6 rounded flex items-center justify-center text-xs {{if eq $i 0}}bg-arcade-amber text-arcade-dark font-bold{{else}}bg-neutral-800 text-neutral-400{{end}}">
                    {{add $i 1}}
                </span>
            </td>
            <td class="p-4 {{if eq $i 0}}text-arcade-amber{{else}}text-neutral-200{{end}}">
                {{$r.Name}}
            </td>
            {{if eq $.Category.VoteType "ranked"}}
            <td class="p-4 text-right text-neutral-400 tabular-nums">{{$r.Points}}</td>
            <td class="p-4 text-right text-neutral-500 tabular-nums">{{$r.FirstPlace}}</td>
            {{else}}
            <td class="p-4 text-right text-neutral-400 tabular-nums">{{$r.Votes}}</td>
            {{end}}
        </tr>
        {{end}}
    </tbody>
</table>
{{end}}
